<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ffcs.dcl.mybatis.persistence.dvmodular.DvModularMapper">
    <resultMap id="BaseResultMap" type="cn.ffcs.dcl.mybatis.domain.dvmodular.DvModular">
        <id column="MODULAR_ID" property="modularId" jdbcType="DECIMAL"/> <!--主键-->
        <result column="UUID" property="uuid" jdbcType="VARCHAR"/> <!--UUID-->
        <result column="THEME_UU_ID" property="themeUuId" jdbcType="VARCHAR"/> <!--主题唯一标识-->
        <result column="NAME" property="name" jdbcType="VARCHAR"/> <!--模块名称-->
        <result column="TYPE" property="type" jdbcType="VARCHAR"/> <!--模块类型-->
        <result column="SEQ" property="seq" jdbcType="DECIMAL"/> <!--排序-->
        <result column="IS_ENABLE" property="isEnable" jdbcType="VARCHAR"/> <!--是否启用-->
        <result column="REMARK" property="remark" jdbcType="VARCHAR"/> <!--备注-->
        <result column="IS_VALID" property="isValid" jdbcType="VARCHAR"/> <!--是否有效-->
        <result column="USE_TYPE" property="useType" jdbcType="VARCHAR"/> <!--使用场景1：首页，2：党建引领，3：乡村治理，4：乡村特色，5：村务政务，6：科技惠农-->

        <result column="REGION_CODE" property="regionCode" jdbcType="VARCHAR"/> <!--是否启用-->
        <result column="REGION_NAME" property="regionName" jdbcType="VARCHAR"/> <!--备注-->
        <result column="THEMENAME" property="themeName" jdbcType="VARCHAR"/> <!--是否有效-->

        <result column="CREATOR" property="creator" jdbcType="DECIMAL"/> <!--创建人-->
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP"/> <!--创建时间-->
        <result column="UPDATOR" property="updator" jdbcType="DECIMAL"/> <!--修改人-->
        <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP"/> <!--修改时间-->
    </resultMap>

    <!-- 列表（总数） -->
    <select id="countList" resultType="java.lang.Long">
        SELECT COUNT(1) FROM
        T_DV_MODULAR T
        INNER JOIN T_DV_THEME T2 on T2.UUID = T.THEME_UU_ID
        <include refid="find_joinTheme_where"/>
    </select>

    <!-- 列表（分页） -->
    <select id="searchList" resultMap="BaseResultMap">
        SELECT
        T.UUID,
        T.THEME_UU_ID,
        T.NAME,
        T.TYPE,
        T.SEQ,
        T.IS_ENABLE,
        T.REMARK,
        T.USE_TYPE,
        T2.NAME THEMENAME,
        T2.REGION_CODE ,
        T2.REGION_NAME
        FROM
        T_DV_MODULAR T
        INNER JOIN T_DV_THEME T2 on T2.UUID = T.THEME_UU_ID
        <include refid="find_joinTheme_where"/>
        ORDER BY
        T.THEME_UU_ID ,T.SEQ
    </select>

    <!-- 列表（条件） -->
    <sql id="find_where">
        <where>
            T.IS_VALID = '1'
            <if test="uuid != null and uuid != '' ">
                <![CDATA[ AND T.UUID = #{uuid, jdbcType=VARCHAR} ]]>
            </if>

            <if test="themeUuId != null and themeUuId != ''">
                <![CDATA[ AND T.THEME_UU_ID = #{themeUuId,jdbcType=VARCHAR} ]]>
            </if>

            <if test="type != null and type != ''">
                <![CDATA[ AND T.TYPE LIKE '%' ||  #{type,jdbcType=VARCHAR} || '%' ]]>
            </if>

            <if test="seq != null and seq != ''">
                <![CDATA[ AND T.SEQ LIKE '%' || #{seq,jdbcType=VARCHAR} || '%' ]]>
            </if>

            <if test="name != null and name != ''">
                <![CDATA[ AND T.NAME LIKE '%' || #{name,jdbcType=VARCHAR} || '%' ]]>
            </if>
        </where>
    </sql>

    <!-- 列表（条件） -->
    <sql id="find_joinTheme_where">
        <where>
            T.IS_VALID = '1'
            AND T2.IS_VALID = '1'
            <if test="uuid != null and uuid != '' ">
                <![CDATA[ AND T.UUID = #{uuid, jdbcType=VARCHAR} ]]>
            </if>

            <if test="themeUuId != null and themeUuId != ''">
                <![CDATA[ AND T.THEME_UU_ID = #{themeUuId,jdbcType=VARCHAR}]]>
            </if>

            <if test="isEnable != null and isEnable != ''">
                <![CDATA[ AND T.IS_ENABLE = #{isEnable,jdbcType=VARCHAR}]]>
            </if>

            <if test="type != null and type != ''">
                <![CDATA[ AND T.TYPE LIKE '%' ||  #{type,jdbcType=VARCHAR} || '%' ]]>
            </if>

            <if test="seq != null and seq != ''">
                <![CDATA[ AND T.SEQ LIKE '%' || #{seq,jdbcType=VARCHAR} || '%' ]]>
            </if>

            <if test="name != null and name != ''">
                <![CDATA[ AND T.NAME LIKE '%' || #{name,jdbcType=VARCHAR} || '%' ]]>
            </if>

            <if test="themeName != null and themeName != ''">
                <![CDATA[ AND T2.NAME LIKE '%' || #{themeName,jdbcType=VARCHAR} || '%' ]]>
            </if>

            <if test="regionCode != null and regionCode != ''">
                <![CDATA[ AND T2.REGION_CODE LIKE #{regionCode,jdbcType=VARCHAR} || '%' ]]>
            </if>

        </where>
    </sql>

    <!-- 新增 -->
    <insert id="insert">
        <selectKey keyProperty="modularId" resultType="long" order="BEFORE">
            SELECT SEQ_DV_MODULAR.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO
        T_DV_MODULAR
        (
        MODULAR_ID,
        UUID,
        THEME_UU_ID,
        NAME,
        TYPE,
        USE_TYPE,
        SEQ,
        IS_ENABLE,
        REMARK,
        IS_VALID,
        CREATOR,
        CREATE_TIME,
        UPDATOR,
        UPDATE_TIME
        ) VALUES (
        #{modularId,jdbcType=DECIMAL},
        SYS_GUID(),
        #{themeUuId,jdbcType=VARCHAR},
        #{name,jdbcType=VARCHAR},
        #{type,jdbcType=VARCHAR},
        #{useType,jdbcType=VARCHAR},
        #{seq,jdbcType=DECIMAL},
        #{isEnable,jdbcType=VARCHAR},
        #{remark,jdbcType=VARCHAR},
        1,
        #{creator,jdbcType=DECIMAL},
        sysdate,
        #{updator,jdbcType=DECIMAL},
        sysdate
        )
    </insert>

    <!-- 修改 -->
    <update id="update">
        UPDATE
        T_DV_MODULAR
        <set>
            <if test="uuid != null ">
                UUID=#{uuid,jdbcType=VARCHAR},
            </if>
            <if test="themeUuId != null ">
                THEME_UU_ID=#{themeUuId,jdbcType=VARCHAR},
            </if>
            <if test="name != null ">
                NAME=#{name,jdbcType=VARCHAR},
            </if>
            <if test="type != null ">
                TYPE=#{type,jdbcType=VARCHAR},
            </if>
            <if test="useType != null ">
                USE_TYPE=#{useType,jdbcType=VARCHAR},
            </if>
            <if test="seq != null ">
                SEQ=#{seq,jdbcType=DECIMAL},
            </if>
            <if test="isEnable != null ">
                IS_ENABLE=#{isEnable,jdbcType=VARCHAR},
            </if>
            <if test="remark != null ">
                REMARK=#{remark,jdbcType=VARCHAR},
            </if>
            <if test="isValid != null ">
                IS_VALID=#{isValid,jdbcType=VARCHAR},
            </if>
            <if test="updator != null ">
                UPDATOR=#{updator,jdbcType=DECIMAL},
            </if>
            UPDATE_TIME = sysdate
        </set>
        WHERE
        UUID = #{uuid, jdbcType=VARCHAR}
    </update>


    <select id="searchByUuid" resultMap="BaseResultMap">
        SELECT
        T.MODULAR_ID,
        T.UUID,
        T.THEME_UU_ID,
        T.NAME,
        T.TYPE,
        T.SEQ,
        T.USE_TYPE,
        T.IS_ENABLE ,
        T.REMARK,
        T.IS_VALID,
        T.CREATOR,
        T.CREATE_TIME,
        T.UPDATOR,
        T2.NAME THEMENAME,
        T2.REGION_CODE ,
        T2.REGION_NAME ,
        T.UPDATE_TIME
        FROM
        T_DV_MODULAR T
        INNER JOIN T_DV_THEME T2 on T2.UUID = T.THEME_UU_ID
        WHERE
        T.UUID = #{uuid,jdbcType=VARCHAR}
    </select>

    <!-- 删除 -->
    <delete id="delete">
		UPDATE
			T_DV_MODULAR
		SET IS_VALID = '0' , UPDATE_TIME = SYSDATE, UPDATOR = #{updator,jdbcType=DECIMAL}
		where UUID = #{uuid,jdbcType=VARCHAR}
	</delete>
    <delete id="batchDelete">
        UPDATE
        T_DV_MODULAR
        SET IS_VALID = '0' , UPDATE_TIME = SYSDATE, UPDATOR = #{updator,jdbcType=DECIMAL}
        WHERE UUID IN
        <foreach collection="uuIdList" index="index" item="item" open="(" separator="," close=")">
            #{item, jdbcType=VARCHAR}
        </foreach>
    </delete>

    <!-- 获取唯一标识 -->
    <select id="getUuid" resultType="String">
		SELECT SYS_GUID() FROM DUAL
	</select>
    <select id="searchByParam" resultMap="BaseResultMap">
        <!-- 根据条件查询数据 -->
        SELECT
        T.MODULAR_ID,
        T.UUID,
        T.THEME_UU_ID,
        T.NAME,
        T.TYPE,
        T.USE_TYPE,
        T.SEQ,
        T.IS_ENABLE,
        T.REMARK,
        T.IS_VALID,
        T.CREATOR,
        T.CREATE_TIME,
        T.UPDATOR,
        T.UPDATE_TIME
        FROM
        T_DV_MODULAR T
        <include refid="find_where"/>
    </select>
</mapper>