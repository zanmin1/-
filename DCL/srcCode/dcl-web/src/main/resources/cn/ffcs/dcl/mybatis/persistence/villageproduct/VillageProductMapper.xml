<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ffcs.dcl.mybatis.persistence.villageproduct.VillageProductMapper">
    <resultMap id="BaseResultMap" type="cn.ffcs.dcl.mybatis.domain.villageproduct.VillageProduct">
        <id column="VILLAGE_PRODUCT_ID" property="villageProductId" jdbcType="DECIMAL"/> <!--主键-->
        <result column="UUID" property="uuid" jdbcType="VARCHAR"/> <!--UUID-->
        <result column="NEW_ID" property="newId" jdbcType="VARCHAR"/> <!--NEW_ID-->
        <result column="STORE_ID" property="storeId" jdbcType="DECIMAL"/> <!--STORE_ID-->
        <result column="GOODS_NAME" property="goodsName" jdbcType="VARCHAR"/> <!--商品名称-->
        <result column="GOODS_TYPE" property="goodsType" jdbcType="VARCHAR"/> <!--商品类型-->
        <result column="MARKET_PRICE_LOW" property="marketPriceLow" jdbcType="DECIMAL"/> <!--市场参考价最低-->
        <result column="MARKET_PRICE_HIGH" property="marketPriceHigh" jdbcType="DECIMAL"/> <!--市场参考价最高-->
        <result column="GOODS_UNIT" property="goodsUnit" jdbcType="VARCHAR"/> <!--商品单位-->
        <result column="REGION_CODE" property="regionCode" jdbcType="VARCHAR"/> <!--产地区域-->
        <result column="REGION_NAME" property="regionName" jdbcType="VARCHAR"/> <!--产地区域名称-->
        <result column="ADDRESS" property="address" jdbcType="VARCHAR"/> <!--产地详细地址-->
        <result column="SHELF" property="shelf" jdbcType="VARCHAR"/> <!--是否上架-->
        <result column="OPERATOR" property="operator" jdbcType="VARCHAR"/> <!--联系人-->
        <result column="TEL" property="tel" jdbcType="VARCHAR"/> <!--联系方式-->
        <result column="GOODS_URL" property="goodsUrl" jdbcType="VARCHAR"/> <!--商品购买链接地址-->
        <result column="GOODS_DESC" property="goodsDesc" jdbcType="VARCHAR"/> <!--产品介绍-->
        <result column="RELEASE_TIME" property="releaseTime" jdbcType="TIMESTAMP"/> <!--发布时间-->
        <result column="ISSU_TIME" property="issuTime" jdbcType="TIMESTAMP"/> <!--上传时间-->
        <result column="PULISHER" property="pulisher" jdbcType="VARCHAR"/> <!--发布人-->
        <result column="ISSU_ORG_NAME" property="issuOrgName" jdbcType="VARCHAR"/> <!--发布机构名称-->
        <result column="ISSU_STATUS" property="issuStatus" jdbcType="VARCHAR"/> <!--发布状态-->
        <result column="PIC_URL" property="picUrl" jdbcType="VARCHAR"/> <!--发布状态-->
    </resultMap>

    <!-- 列表（总数） -->
    <select id="countList" resultType="java.lang.Long">
        SELECT COUNT(1) FROM T_DV_VILLAGE_PRODUCT T
        <include refid="find_where"/>
    </select>

    <!-- 列表（分页） -->
    <select id="searchList" resultMap="BaseResultMap">

        SELECT
        T.UUID,
        T.GOODS_NAME,
        T.GOODS_TYPE,
        T.MARKET_PRICE_LOW,
        T.MARKET_PRICE_HIGH,
        T.GOODS_UNIT,
        T.REGION_CODE,
        T.REGION_NAME,
        T.ADDRESS,
        T.SHELF,
        T.OPERATOR,
        T.TEL,
        T.GOODS_URL,
        T.GOODS_DESC,
        T.RELEASE_TIME,
        T.ISSU_TIME,
        T.PULISHER,
        T.ISSU_ORG_NAME,
        T.PIC_URL,
        T.ISSU_STATUS,
        T.NEW_ID,
        T.STORE_ID

        FROM T_DV_VILLAGE_PRODUCT T
        <include refid="find_where"/>
        ORDER BY T.VILLAGE_PRODUCT_ID DESC
    </select>

    <!-- 列表（条件） -->
    <sql id="find_where">
        <where>
            AND T.IS_VALID = '1'
            <if test="goodsName != null and goodsName != ''">
                <![CDATA[ AND T.GOODS_NAME LIKE '%'||#{goodsName, jdbcType=VARCHAR}||'%' ]]>
            </if>


            <if test="regionCode != null and regionCode != '' and type==null">
                <![CDATA[ AND T.REGION_CODE LIKE #{regionCode, jdbcType=VARCHAR}||'%' ]]>
            </if>

            <if test="regionCode != null and regionCode != '' and type=='around'">
                <![CDATA[
             AND T.REGION_CODE NOT LIKE #{regionCode, jdbcType=VARCHAR} ||'%'
             AND T.REGION_CODE LIKE substr ( ${regionCode} ,1 ,2)  ||'%'
             ]]>
            </if>

            <if test="goodsType != null and goodsType != ''">
                <![CDATA[ AND T.GOODS_TYPE = #{goodsType, jdbcType=VARCHAR} ]]>
            </if>
            <if test="shelf != null and shelf != ''">
                <![CDATA[ AND T.SHELF = #{shelf, jdbcType=VARCHAR} ]]>
            </if>
            <if test="issuStatus != null and issuStatus != ''">
                <![CDATA[ AND T.ISSU_STATUS = #{issuStatus, jdbcType=VARCHAR} ]]>
            </if>

        </where>
    </sql>

    <select id="getUuid" resultType="String">
        SELECT SYS_GUID() FROM DUAL
    </select>
    <select id="getSysdate" resultType="java.util.Date">
        SELECT SYSDATE FROM DUAL
    </select>

    <!-- 新增 -->
    <insert id="insert" parameterType="cn.ffcs.dcl.mybatis.domain.villageproduct.VillageProduct">
        <selectKey keyProperty="villageProductId" resultType="long" order="BEFORE">
            SELECT SEQ_DV_VILLAGE_PRODUCT.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO T_DV_VILLAGE_PRODUCT (
        VILLAGE_PRODUCT_ID,
        UUID,
        GOODS_NAME,
        GOODS_TYPE,
        MARKET_PRICE_LOW,
        MARKET_PRICE_HIGH,
        GOODS_UNIT,
        REGION_CODE,
        REGION_NAME,
        ADDRESS,
        SHELF,
        OPERATOR,
        TEL,
        GOODS_URL,
        GOODS_DESC,
        RELEASE_TIME,
        ISSU_TIME,
        PULISHER,
        ISSU_ORG_NAME,
        ISSU_STATUS,
        REMARK,
        IS_VALID,
        CREATOR,
        CREATE_TIME,
        UPDATOR,
        UPDATE_TIME,
        PIC_URL,
		STORE_ID,
        NEW_ID
        ) VALUES (
        #{villageProductId, jdbcType=DECIMAL},
        #{uuid, jdbcType=VARCHAR},
        #{goodsName, jdbcType=VARCHAR},
        #{goodsType, jdbcType=VARCHAR},
        #{marketPriceLow, jdbcType=DECIMAL},
        #{marketPriceHigh, jdbcType=DECIMAL},
        #{goodsUnit, jdbcType=VARCHAR},
        #{regionCode, jdbcType=VARCHAR},
        #{regionName, jdbcType=VARCHAR},
        #{address, jdbcType=VARCHAR},
        #{shelf, jdbcType=VARCHAR},
        #{operator, jdbcType=VARCHAR},
        #{tel, jdbcType=VARCHAR},
        #{goodsUrl, jdbcType=VARCHAR},
        #{goodsDesc, jdbcType=VARCHAR},
        #{releaseTime, jdbcType=TIMESTAMP},
        SYSDATE,
        #{pulisher, jdbcType=VARCHAR},
        #{issuOrgName, jdbcType=VARCHAR},
        #{issuStatus, jdbcType=VARCHAR},
        #{remark, jdbcType=VARCHAR},
        1,
        #{creator, jdbcType=DECIMAL},
        SYSDATE,
        #{creator, jdbcType=DECIMAL},
        SYSDATE,
        #{picUrl, jdbcType=VARCHAR},
        #{storeId, jdbcType=DECIMAL},
        #{newId, jdbcType=VARCHAR}
        )
    </insert>

    <!-- 修改 -->
    <update id="update" parameterType="cn.ffcs.dcl.mybatis.domain.villageproduct.VillageProduct">
        UPDATE T_DV_VILLAGE_PRODUCT
        <set>
            <if test="goodsName != null ">
                GOODS_NAME = #{goodsName, jdbcType=VARCHAR},
            </if>
            <if test="goodsType != null ">
                GOODS_TYPE = #{goodsType, jdbcType=VARCHAR},
            </if>
            <if test="marketPriceLow != null ">
                MARKET_PRICE_LOW = #{marketPriceLow, jdbcType=DECIMAL},
            </if>
            <if test="marketPriceHigh != null ">
                MARKET_PRICE_HIGH = #{marketPriceHigh, jdbcType=DECIMAL},
            </if>
            <if test="goodsUnit != null ">
                GOODS_UNIT = #{goodsUnit, jdbcType=VARCHAR},
            </if>
            <if test="regionCode != null ">
                REGION_CODE = #{regionCode, jdbcType=VARCHAR},
            </if>
            <if test="regionName != null ">
                REGION_NAME = #{regionName, jdbcType=VARCHAR},
            </if>
            <if test="address != null ">
                ADDRESS = #{address, jdbcType=VARCHAR},
            </if>
            <if test="shelf != null ">
                SHELF = #{shelf, jdbcType=VARCHAR},
            </if>
            <if test="operator != null ">
                OPERATOR = #{operator, jdbcType=VARCHAR},
            </if>
            <if test="tel != null ">
                TEL = #{tel, jdbcType=VARCHAR},
            </if>
            <if test="goodsUrl != null ">
                GOODS_URL = #{goodsUrl, jdbcType=VARCHAR},
            </if>
            <if test="goodsDesc != null ">
                GOODS_DESC = #{goodsDesc, jdbcType=VARCHAR},
            </if>
            <if test="releaseTime != null ">
                RELEASE_TIME = #{releaseTime, jdbcType=TIMESTAMP},
            </if>
            <if test="issuTime != null ">
                ISSU_TIME = #{issuTime, jdbcType=TIMESTAMP},
            </if>
            <if test="pulisher != null ">
                PULISHER = #{pulisher, jdbcType=VARCHAR},
            </if>
            <if test="issuOrgName != null ">
                ISSU_ORG_NAME = #{issuOrgName, jdbcType=VARCHAR},
            </if>
            <if test="issuStatus != null ">
                ISSU_STATUS = #{issuStatus, jdbcType=VARCHAR},
            </if>
            <if test="remark != null ">
                REMARK = #{remark, jdbcType=VARCHAR},
            </if>
            <if test="picUrl != null ">
                PIC_URL = #{picUrl, jdbcType=VARCHAR},
            </if>
            <if test="updator != null ">
                UPDATOR = #{updator, jdbcType=DECIMAL},
            </if>
            <if test="newId != null ">
                NEW_ID = #{newId, jdbcType=VARCHAR},
            </if>
            <if test="storeId != null ">
                STORE_ID = #{storeId, jdbcType=DECIMAL},
            </if>
            UPDATE_TIME = SYSDATE
        </set>
        WHERE 
            <if test="uuid != null ">
                UUID = #{updator, jdbcType=VARCHAR}
            </if>
            <if test="newId != null ">
                NEW_ID = #{newId, jdbcType=VARCHAR}
            </if>
            <if test="storeId != null ">
                STORE_ID = #{storeId, jdbcType=DECIMAL}
            </if>
            AND IS_VALID = '1'
    </update>

    <!-- 详情 -->
    <select id="searchById" resultMap="BaseResultMap">
		SELECT
			T.VILLAGE_PRODUCT_ID,
			T.UUID,
			T.GOODS_NAME,
			T.GOODS_TYPE,
			T.MARKET_PRICE_LOW,
			T.MARKET_PRICE_HIGH,
			T.GOODS_UNIT,
			T.REGION_CODE,
			T.REGION_NAME,
			T.ADDRESS,
			T.SHELF,
			T.OPERATOR,
			T.TEL,
			T.GOODS_URL,
			T.GOODS_DESC,
			T.RELEASE_TIME,
			T.ISSU_TIME,
			T.PULISHER,
			T.ISSU_ORG_NAME,
			T.PIC_URL,
			T.ISSU_STATUS,
			T.NEW_ID,
			T.STORE_ID
		FROM T_DV_VILLAGE_PRODUCT T
        WHERE
            <if test="uuid != null ">
                UUID = #{updator, jdbcType=VARCHAR}
            </if>
            <if test="newId != null ">
                NEW_ID = #{newId, jdbcType=VARCHAR}
            </if>
            <if test="id != null ">
                VILLAGE_PRODUCT_ID = #{id, jdbcType=DECIMAL}
            </if>
            AND T.IS_VALID = '1'
	</select>
	
    <!-- 详情 -->
    <select id="searchByUuid" parameterType="String" resultMap="BaseResultMap">
		SELECT
			T.VILLAGE_PRODUCT_ID,
			T.UUID,
			T.GOODS_NAME,
			T.GOODS_TYPE,
			T.MARKET_PRICE_LOW,
			T.MARKET_PRICE_HIGH,
			T.GOODS_UNIT,
			T.REGION_CODE,
			T.REGION_NAME,
			T.ADDRESS,
			T.SHELF,
			T.OPERATOR,
			T.TEL,
			T.GOODS_URL,
			T.GOODS_DESC,
			T.RELEASE_TIME,
			T.ISSU_TIME,
			T.PULISHER,
			T.ISSU_ORG_NAME,
			T.PIC_URL,
			T.ISSU_STATUS,
			T.NEW_ID,
			T.STORE_ID
		FROM T_DV_VILLAGE_PRODUCT T
        WHERE T.UUID = #{uuid, jdbcType=VARCHAR}
	</select>

    <!-- 删除 -->
    <delete id="delete" parameterType="cn.ffcs.dcl.mybatis.domain.villageproduct.VillageProduct">
		UPDATE T_DV_VILLAGE_PRODUCT
		SET IS_VALID = '0', UPDATE_TIME = SYSDATE, UPDATOR = #{updator, jdbcType=DECIMAL}
        WHERE 
            <if test="uuid != null ">
                UUID = #{updator, jdbcType=VARCHAR}
            </if>
            <if test="newId != null ">
                NEW_ID = #{newId, jdbcType=VARCHAR}
            </if>
	</delete>
</mapper>