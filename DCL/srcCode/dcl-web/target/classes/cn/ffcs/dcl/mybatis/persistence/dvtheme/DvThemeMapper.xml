<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ffcs.dcl.mybatis.persistence.dvtheme.DvThemeMapper">
    <resultMap id="BaseResultMap" type="cn.ffcs.dcl.mybatis.domain.dvtheme.DvTheme">
        <id column="THEME_ID" property="themeId" jdbcType="DECIMAL"/> <!--主键-->
        <result column="UUID" property="uuid" jdbcType="VARCHAR"/> <!--UUID-->
        <result column="NAME" property="name" jdbcType="VARCHAR"/> <!--主题名称-->
        <result column="PLATFORM" property="platform" jdbcType="VARCHAR"/> <!--使用平台-->
        <result column="REGION_CODE" property="regionCode" jdbcType="VARCHAR"/> <!--所属区域-->
        <result column="REGION_NAME" property="regionName" jdbcType="VARCHAR"/> <!--所属区域名称-->
        <result column="REMARK" property="remark" jdbcType="VARCHAR"/> <!--备注-->
        <result column="IS_VALID" property="isValid" jdbcType="VARCHAR"/> <!--是否有效-->
        <result column="CREATOR" property="creator" jdbcType="DECIMAL"/> <!--创建人-->
        <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP"/> <!--创建时间-->
        <result column="UPDATOR" property="updator" jdbcType="DECIMAL"/> <!--修改人-->
        <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP"/> <!--修改时间-->
    </resultMap>

    <!-- 列表（总数） -->
    <select id="countList" resultType="java.lang.Long">
        SELECT COUNT(1) FROM T_DV_THEME T
        <include refid="find_where"/>
    </select>

    <!-- 列表（分页） -->
    <select id="searchList" resultMap="BaseResultMap">
        SELECT
        T.UUID,
        T.NAME,
        T.REGION_CODE,
        T.PLATFORM,
        T.REGION_NAME
        FROM
        T_DV_THEME T
        <include refid="find_where"/>
        ORDER BY
        T.UPDATE_TIME DESC
    </select>

    <!-- 列表（条件） -->
    <sql id="find_where">
        <where>
            T.IS_VALID = '1'
            <if test="uuid != null and uuid != '' ">
                <![CDATA[ AND T.UUID = #{uuid, jdbcType=VARCHAR} ]]>
            </if>

            <if test="regionCode != null and regionCode != ''">
                <![CDATA[ AND T.REGION_CODE LIKE #{regionCode,jdbcType=VARCHAR} || '%' ]]>
            </if>
-- 新增修改时在查询地区重复值时在searchByParam方法使用
            <if test="regionName != null and regionName != ''">
                <![CDATA[ AND T.REGION_NAME = #{regionName,jdbcType=VARCHAR}]]>
            </if>

            <if test="name != null and name != ''">
                <![CDATA[ AND T.NAME LIKE '%' || #{name,jdbcType=VARCHAR} || '%' ]]>
            </if>

            <if test="platform != null and platform != ''">
                <![CDATA[ AND T.PLATFORM LIKE '%' || #{platform,jdbcType=VARCHAR} || '%' ]]>
            </if>
        </where>
    </sql>

    <!-- 新增 -->
    <insert id="insert" parameterType="cn.ffcs.dcl.mybatis.domain.dvtheme.DvTheme">
        <selectKey keyProperty="themeId" resultType="long" order="BEFORE">
            SELECT SEQ_DV_THEME.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO
        T_DV_THEME
        (
        THEME_ID,
        UUID,
        NAME,
        PLATFORM,
        REGION_CODE,
        REGION_NAME,
        REMARK,
        IS_VALID,
        CREATOR,
        CREATE_TIME,
        UPDATOR ,
        UPDATE_TIME
        ) VALUES (
        #{themeId,jdbcType=DECIMAL},
        SYS_GUID(),
        #{name,jdbcType=VARCHAR},
        #{platform,jdbcType=VARCHAR},
        #{regionCode,jdbcType=VARCHAR},
        #{regionName,jdbcType=VARCHAR},
        #{remark,jdbcType=VARCHAR},
        1,
        #{creator,jdbcType=DECIMAL},
        sysdate,
        #{updator,jdbcType=DECIMAL},
        sysdate
        )
    </insert>

    <!-- 修改 -->
    <update id="update" parameterType="cn.ffcs.dcl.mybatis.domain.dvtheme.DvTheme">
        UPDATE
        T_DV_THEME
        <set>
            <if test="uuid != null ">
                UUID=#{uuid,jdbcType=VARCHAR},
            </if>
            <if test="name != null ">
                NAME=#{name,jdbcType=VARCHAR},
            </if>
            <if test="platform != null ">
                PLATFORM=#{platform,jdbcType=VARCHAR},
            </if>
            <if test="regionCode != null ">
                REGION_CODE=#{regionCode,jdbcType=VARCHAR},
            </if>
            <if test="regionName != null ">
                REGION_NAME=#{regionName,jdbcType=VARCHAR},
            </if>
            <if test="remark != null ">
                REMARK=#{remark,jdbcType=VARCHAR},
            </if>
            <if test="isValid != null ">
                IS_VALID=#{isValid,jdbcType=VARCHAR},
            </if>
            <if test="updator != null ">
                UPDATOR=#{updator,jdbcType=DECIMAL},
            </if>
            UPDATE_TIME = sysdate
        </set>
        WHERE
        UUID = #{uuid, jdbcType=VARCHAR}
    </update>


    <select id="searchByUuid" resultMap="BaseResultMap">
		SELECT
			T.THEME_ID,
			T.UUID,
			T.NAME,
			T.PLATFORM,
			T.REGION_CODE,
			T.REGION_NAME,
			T.REMARK,
			T.IS_VALID,
			T.CREATOR,
			T.CREATE_TIME,
			T.UPDATOR,
			T.UPDATE_TIME
		FROM
			T_DV_THEME T
		WHERE
			T.UUID = #{uuid,jdbcType=VARCHAR}
	</select>

    <!-- 删除 -->
    <delete id="delete" >
		UPDATE
			T_DV_THEME
		SET IS_VALID = '0' , UPDATE_TIME = SYSDATE, UPDATOR = #{updator,jdbcType=DECIMAL}
		where UUID = #{uuid,jdbcType=VARCHAR}
	</delete>
    <delete id="batchDelete">
		UPDATE
			T_DV_THEME
		SET IS_VALID = '0' , UPDATE_TIME = SYSDATE, UPDATOR = #{updator,jdbcType=DECIMAL}
		WHERE UUID IN
		<foreach collection="uuIdList" index="index" item="item" open="(" separator="," close=")">
			#{item, jdbcType=VARCHAR}
		</foreach>
    </delete>

    <!-- 获取唯一标识 -->
    <select id="getUuid" resultType="String">
		SELECT SYS_GUID() FROM DUAL
	</select>
    <select id="searchByParam" resultMap="BaseResultMap">
        <!-- 根据条件查询数据 -->
        SELECT
        T.UUID,
        T.NAME,
        T.PLATFORM,
        T.REGION_CODE,
        T.REGION_NAME,
        T.REMARK,
        T.IS_VALID,
        T.CREATOR,
        T.CREATE_TIME,
        T.UPDATOR,
        T.UPDATE_TIME
        FROM
        T_DV_THEME T
		<include refid="find_where"/>
    </select>

    <select id="searchListByBsfl" resultMap="BaseResultMap">
        <!-- 根据条件查询数据 -->
        SELECT
        distinct T.REGION_CODE,
        T.UUID,
        T.NAME,
        T.PLATFORM,
        T.REGION_NAME,
        T.UPDATE_TIME
        FROM
        T_DV_THEME T
        INNER JOIN T_DV_MODULAR T2
        ON T2.IS_VALID = '1' and T.UUID = T2.THEME_UU_ID AND T2.NAME = '办事分类'
        <include refid="find_where"/>
        ORDER BY
        T.UPDATE_TIME DESC
    </select>

    <!-- 列表（总数） -->
    <select id="countListByBsfl" resultType="java.lang.Long">
        SELECT COUNT(1) FROM
        T_DV_THEME T
        INNER JOIN T_DV_MODULAR T2
        ON T.IS_VALID = '1' and T.UUID = T2.THEME_UU_ID AND T2.NAME = '办事分类'
        ORDER BY
        T.UPDATE_TIME DESC
    </select>


</mapper>