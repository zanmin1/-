<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.ffcs.dcl.mybatis.persistence.villagegroup.VillageGroupMapper">
    <resultMap id="BaseResultMap" type="cn.ffcs.dcl.mybatis.domain.villagegroup.VillageGroup">
        <id column="VILLAGE_GROUP_ID" property="villageGroupId" jdbcType="DECIMAL"/> <!--主键-->
        <result column="UUID" property="uuid" jdbcType="VARCHAR"/> <!--唯一标识-->
        <result column="NAME" property="name" jdbcType="VARCHAR"/> <!--名称-->
        <result column="TYPE" property="type" jdbcType="VARCHAR"/> <!--类型-->
        <result column="JOB" property="job" jdbcType="VARCHAR"/> <!--职务-->
        <result column="TEL" property="tel" jdbcType="VARCHAR"/> <!--联系方式-->
        <result column="ID_NO" property="idNo" jdbcType="VARCHAR"/> <!--身份证号-->
        <result column="REGION_CODE" property="regionCode" jdbcType="VARCHAR"/> <!--区域-->
        <result column="REGION_NAME" property="regionName" jdbcType="VARCHAR"/> <!--区域名称-->
        <result column="SEQ" property="seq" jdbcType="DECIMAL"/> <!--排序-->
        <result column="INTRODUCTION" property="introduction" jdbcType="VARCHAR"/> <!--人员介绍-->
        <result column="SEX" property="sex" jdbcType="VARCHAR"/>
        <result column="BIRTHDAY" property="birthday" jdbcType="VARCHAR"/>
        <result column="REMARK" property="remark" jdbcType="VARCHAR"/> <!--备注-->
        <result column="IMAGE" property="image" jdbcType="VARCHAR"/> <!--备注-->
        <!--		<result column="IS_VALID" property="isValid" jdbcType="VARCHAR" /> &lt;!&ndash;是否有效&ndash;&gt;-->
        <!--		<result column="CREATOR" property="creator" jdbcType="DECIMAL" /> &lt;!&ndash;创建人&ndash;&gt;-->
        <!--		<result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" /> &lt;!&ndash;创建时间&ndash;&gt;-->
        <!--		<result column="UPDATOR" property="updator" jdbcType="DECIMAL" /> &lt;!&ndash;修改人&ndash;&gt;-->
        <!--		<result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" /> &lt;!&ndash;修改时间&ndash;&gt;-->
    </resultMap>

    <!-- 列表（总数） -->
    <select id="countList" resultType="java.lang.Long">
        SELECT COUNT(1) FROM T_DV_VILLAGE_GROUP T
        <include refid="find_where"/>
    </select>

    <!-- 列表（分页） -->
    <select id="searchList" resultMap="BaseResultMap">
        SELECT
            T.UUID,
            T.NAME,
            T.TYPE,
            T.JOB,
            T.TEL,
            T.ID_NO,
            T.REGION_CODE,
            T.REGION_NAME,
            T.SEQ,
            T.INTRODUCTION,
            T.SEX,
            T.BIRTHDAY,
            T.REMARK
        FROM T_DV_VILLAGE_GROUP T
        <include refid="find_where"/>
        ORDER BY T.SEQ NULLS LAST, T.VILLAGE_GROUP_ID DESC
    </select>

    <!-- 列表（条件） -->
    <sql id="find_where">
        <where>
            T.IS_VALID = '1'
            <if test="name != null and name != '' ">
                AND T.NAME Like '%' || #{name, jdbcType=VARCHAR} || '%'
            </if>
            <if test="type != null and type != '' ">
                AND T.TYPE = #{type, jdbcType=VARCHAR}
            </if>
            <if test="regionCode != null and regionCode != '' ">
                AND T.REGION_CODE Like #{regionCode, jdbcType=VARCHAR} || '%'
            </if>
        </where>
    </sql>

    <!-- 新增 -->
    <insert id="insert" parameterType="cn.ffcs.dcl.mybatis.domain.villagegroup.VillageGroup">
        <selectKey keyProperty="villageGroupId" resultType="long" order="BEFORE">
            SELECT SEQ_DV_VILLAGE_GROUP.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO T_DV_VILLAGE_GROUP(
            VILLAGE_GROUP_ID,
            UUID,
            NAME,
            TYPE,
            JOB,
            TEL,
            ID_NO,
            REGION_CODE,
            REGION_NAME,
            SEQ,
            INTRODUCTION,
            SEX,
            BIRTHDAY,
            REMARK,
            IS_VALID,
            CREATOR,
            CREATE_TIME,
            UPDATOR,
            UPDATE_TIME
        ) VALUES (
        #{villageGroupId, jdbcType=DECIMAL},
            SYS_GUID(),
            #{name, jdbcType=VARCHAR},
            #{type, jdbcType=VARCHAR},
            #{job, jdbcType=VARCHAR},
            #{tel, jdbcType=VARCHAR},
            #{idNo, jdbcType=VARCHAR},
            #{regionCode, jdbcType=VARCHAR},
            #{regionName, jdbcType=VARCHAR},
            #{seq, jdbcType=DECIMAL},
            #{introduction, jdbcType=VARCHAR},
            #{sex, jdbcType=VARCHAR},
            #{birthday, jdbcType=VARCHAR},
            #{remark, jdbcType=VARCHAR},
            '1',
            #{creator, jdbcType=DECIMAL},
            SYSDATE,
            #{creator, jdbcType=DECIMAL},
            SYSDATE
        )
    </insert>

    <!-- 修改 -->
    <update id="update" parameterType="cn.ffcs.dcl.mybatis.domain.villagegroup.VillageGroup">
        UPDATE T_DV_VILLAGE_GROUP
        <set>
            <if test="uuid != null ">
                UUID = #{uuid, jdbcType=VARCHAR},
            </if>
            <if test="name != null ">
                NAME = #{name, jdbcType=VARCHAR},
            </if>
            <if test="type != null ">
                TYPE = #{type, jdbcType=VARCHAR},
            </if>
            <if test="job != null ">
                JOB = #{job, jdbcType=VARCHAR},
            </if>
            <if test="tel != null ">
                TEL = #{tel, jdbcType=VARCHAR},
            </if>
            <if test="idNo != null ">
                ID_NO = #{idNo, jdbcType=VARCHAR},
            </if>
            <if test="regionCode != null ">
                REGION_CODE = #{regionCode, jdbcType=VARCHAR},
            </if>
            <if test="regionName != null ">
                REGION_NAME = #{regionName, jdbcType=VARCHAR},
            </if>
            <if test="seq != null ">
                SEQ = #{seq, jdbcType=DECIMAL},
            </if>
            <if test="introduction != null ">
                INTRODUCTION = #{introduction, jdbcType=VARCHAR},
            </if>
            <if test="remark != null ">
                REMARK = #{remark, jdbcType=VARCHAR},
            </if>
            <if test="sex != null ">
                SEX = #{sex, jdbcType=VARCHAR},
            </if>
            <if test="birthday != null ">
                BIRTHDAY = #{birthday, jdbcType=VARCHAR},
            </if>
            <if test="updator != null ">
                UPDATOR = #{updator, jdbcType=DECIMAL},
            </if>
            UPDATE_TIME = SYSDATE
        </set>
        WHERE UUID = #{uuid, jdbcType=VARCHAR}
    </update>

    <!-- 详情 -->
    <select id="searchByUuid" parameterType="String" resultMap="BaseResultMap">
        SELECT
            T.VILLAGE_GROUP_ID,
            T.UUID,
            T.NAME,
            T.TYPE,
            T.JOB,
            T.TEL,
            T.ID_NO,
            T.REGION_CODE,
            T.REGION_NAME,
            T.SEQ,
            T.INTRODUCTION,
            T.SEX,
            T.BIRTHDAY,
            T.REMARK
        FROM T_DV_VILLAGE_GROUP T
        WHERE IS_VALID = '1' AND UUID = #{uuid, jdbcType=VARCHAR}
    </select>

    <!-- 详情 -->
    <select id="searchById" parameterType="long" resultMap="BaseResultMap">
        SELECT
            T.VILLAGE_GROUP_ID,
            T.UUID,
            T.NAME,
            T.TYPE,
            T.JOB,
            T.TEL,
            T.ID_NO,
            T.REGION_CODE,
            T.REGION_NAME,
            T.SEQ,
            T.INTRODUCTION,
            T.SEX,
            T.BIRTHDAY,
            T.REMARK
        FROM T_DV_VILLAGE_GROUP T
        WHERE IS_VALID = '1' AND VILLAGE_GROUP_ID = #{id, jdbcType=VARCHAR}
    </select>

    <!-- 删除 -->
    <delete id="delete" parameterType="cn.ffcs.dcl.mybatis.domain.villagegroup.VillageGroup">
		UPDATE T_DV_VILLAGE_GROUP
		SET IS_VALID = '0', UPDATE_TIME = SYSDATE, UPDATOR = #{updator, jdbcType=DECIMAL}
        WHERE UUID = #{uuid, jdbcType=VARCHAR}
    </delete>


    <!-- 列表（分页） -->
    <select id="searchListWithImage" resultMap="BaseResultMap">
        SELECT
            T.UUID,
            T.NAME,
            T.TYPE,
            T.JOB,
            T.TEL,
            T.ID_NO,
            T.REGION_CODE,
            T.REGION_NAME,
            T.SEQ,
            T.INTRODUCTION,
            T.SEX,
            T.BIRTHDAY,
            T.REMARK,
            A.FILE_PATH IMAGE
        FROM T_DV_VILLAGE_GROUP T
        LEFT JOIN ${dbuser.zhsq}.T_ATTACHMENT_BY_UUID A ON T.UUID = A.BIZ_UUID AND A.STATUS = '001' AND A.ATTACHMENT_TYPE = 'DCL_VILLAGE_GROUP_IMAGE'
        <include refid="find_where"/>
        ORDER BY T.SEQ NULLS LAST, T.VILLAGE_GROUP_ID DESC
    </select>
</mapper>